@page "/general/book"
@using StoryForge.Application.Projects
@using StoryForge.Core.Data
@inject BreadCrumbHandler crumbHandler;
@inject ISender sender;

<PageTitle>@Title</PageTitle>
<MudText Typo="Typo.h4" Class="mb-4">@Title</MudText>

<MudStack Spacing="2">
    <MudTextField @bind-Value="BookTitle" Label="Title" Variant="Variant.Outlined" />
    <MudTextField @bind-Value="BookSubtitle" Label="Subtitle" Variant="Variant.Outlined" />
    <MudTextField @bind-Value="BookSeries" Label="Series" Variant="Variant.Outlined" />
    <MudTextField @bind-Value="BookVolume" Label="Volume" Variant="Variant.Outlined" />
    <MudTextField @bind-Value="BookGenre" Label="Genre" Variant="Variant.Outlined" />
</MudStack>

@code {
    const string Title = "Book Information";

    string BookTitle
    {
        get => bookData?.Title ?? string.Empty;
        set {
            if (bookData is null) return;
            bookData.Title = value;
            SaveData();
        }
    }

    string BookSubtitle
    {
        get => bookData?.Subtitle ?? string.Empty;
        set
        {
            if (bookData is null) return;
            bookData.Subtitle = value;
            SaveData();
        }
    }

    string BookSeries
    {
        get => bookData?.Series ?? string.Empty;
        set
        {
            if (bookData is null) return;
            bookData.Series = value;
            SaveData();
        }
    }

    string BookVolume
    {
        get => bookData?.Volume ?? string.Empty;
        set
        {
            if (bookData is null) return;
            bookData.Volume = value;
            SaveData();
        }
    }

    string BookGenre
    {
        get => bookData?.Genre ?? string.Empty;
        set
        {
            if (bookData is null) return;
            bookData.Genre = value;
            SaveData();
        }
    }

    Book? bookData;

    protected override async Task OnInitializedAsync()
    {
        crumbHandler.Items.Clear();
        crumbHandler.Items.Add(new("General", "/general", Icons.Material.Filled.Dashboard));
        crumbHandler.Items.Add(new(Title, "/general/book", null));
        crumbHandler.NavigationChange?.Invoke();

        var bookResult = await sender.Send(new GetBookOperation());
        bookData = bookResult.Or(Book.Invalid);
    }

    void SaveData()
    {
        if (bookData is null) return;
        _ = sender.Send(new UpdateBookOperation(bookData));
    }
}
