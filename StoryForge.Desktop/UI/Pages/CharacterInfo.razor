@page "/characters/{id}"
@using StoryForge.Application.Characters
@using StoryForge.Core.Data
@using StoryForge.Core.Utils
@inject BreadCrumbHandler crumbHandler;
@inject NavigationManager navigationManager;
@inject ISender Sender;

<PageTitle>@Title</PageTitle>
<MudText Typo="Typo.h4" Class="mb-4">@Title</MudText>

<MudStack Spacing="2">
    <MudTabs Rounded="true" Centered="true">
        <MudTabPanel Text="Basic Info" Class="pt-2">
            <MudStack Spacing="2">
                <MudTextField @bind-Value="CharacterName" Label="Name" Variant="Variant.Outlined" />
                <MudStack Row="true" Spacing="4">
                    <MudText Class="mr-4">Importance</MudText>
                    <MudSlider TickMarks="true" Min="0" Max="2" @bind-Value="Importance"></MudSlider>
                    <MudText>@Importance</MudText>
                    <div class="w-full"></div>
                </MudStack>
                <MudTextField @bind-Value="CharacterMotivation" Label="Motivation" Lines="3" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="CharacterGoal" Label="Goal" Lines="3" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="CharacterConflict" Label="Conflict" Lines="3" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="CharacterEpiphany" Label="Epiphany" Lines="3" Variant="Variant.Outlined" />
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Summary" Class="pt-2">
            <MudStack Spacing="2">
                <MudTextField @bind-Value="SentenceSummary" Label="One-Sentence Summary" Lines="2" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="ParagraphSummary" Label="One-Paragraph Summary" Lines="8" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="PageSummary" Label="One-Page Summary" Lines="18" Variant="Variant.Outlined" />
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Notes" Class="pt-2">
            <MudTextField @bind-Value="Notes" Label="Notes" Lines="18" Variant="Variant.Outlined" />
        </MudTabPanel>
        <MudTabPanel Text="Detailed Info" Class="pt-2">
            <MudTextField @bind-Value="Details" Label="Details" Lines="18" Variant="Variant.Outlined" />
        </MudTabPanel>
    </MudTabs>
</MudStack>

@code {
    const string Title = "Character Information";

    [Parameter]
    public string Id { get; set; } = default!;

    int Importance { get; set; } = 0;

    string CharacterName { get; set; } = string.Empty;
    string CharacterMotivation { get; set; } = string.Empty;
    string CharacterGoal { get; set; } = string.Empty;
    string CharacterConflict { get; set; } = string.Empty;
    string CharacterEpiphany { get; set; } = string.Empty;

    string SentenceSummary { get; set; } = string.Empty;
    string ParagraphSummary { get; set; } = string.Empty;
    string PageSummary { get; set; } = string.Empty;

    string Notes { get; set; } = string.Empty;
    string Details { get; set; } = string.Empty;

    Character? characterData;

    protected override async Task OnInitializedAsync()
    {
        crumbHandler.Items.Clear();
        crumbHandler.Items.Add(new("Characters", "/characters", Icons.Material.Filled.People));
        crumbHandler.Items.Add(new(Title, $"/characters/{Id}", null));
        crumbHandler.NavigationChange?.Invoke();

        var characterResult = await Sender.Send(new GetCharacterOperation(CharacterId.From(Id)));
        characterResult
            .Then(character =>
                {
                    characterData = character;
                    return Result<Character>.Ok(character);
                })
            .OnError(msg => navigationManager.NavigateTo("/error"));
    }
}
