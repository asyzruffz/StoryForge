@page "/general/author"
@using StoryForge.Application.Projects
@using StoryForge.Core.Data
@inject BreadCrumbHandler crumbHandler;
@inject ISender sender;

<PageTitle>@Title</PageTitle>
<MudText Typo="Typo.h4" Class="mb-4">@Title</MudText>

<MudStack Spacing="2">
    <MudTextField @bind-Value="AuthorName" Label="Name" Variant="Variant.Outlined" />
    <MudTextField @bind-Value="AuthorEmail" Label="Email" Variant="Variant.Outlined" />
</MudStack>

@code {
    const string Title = "Author Information";

    string AuthorName
    {
        get => authorData?.Name ?? string.Empty;
        set
        {
            if (authorData is null) return;
            authorData.Name = value;
            SaveData();
        }
    }

    string AuthorEmail
    {
        get => authorData?.Email ?? string.Empty;
        set
        {
            if (authorData is null) return;
            if (string.IsNullOrEmpty(value))
            {
                authorData.Email = null;
            }
            else
            {
                authorData.Email = value;
            }
            SaveData();
        }
    }

    Author? authorData;

    protected override async Task OnInitializedAsync()
    {
        crumbHandler.Items.Clear();
        crumbHandler.Items.Add(new("General", "/general", Icons.Material.Filled.Dashboard));
        crumbHandler.Items.Add(new(Title, "/general/author", null));
        crumbHandler.NavigationChange?.Invoke();

        var authorResult = await sender.Send(new GetAuthorOperation());
        authorData = authorResult.Or(Author.Invalid);
    }

    void SaveData()
    {
        if (authorData is null) return;
        _ = sender.Send(new UpdateAuthorOperation(authorData));
    }
}
